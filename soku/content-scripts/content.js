(()=>{"use strict";function e(){try{document.querySelectorAll("a")}catch(e){}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),chrome.runtime.onMessage.addListener(((e,t,n)=>{try{if("ping"===e.action)return n({status:"pong",url:window.location.href,initialized:window.sokucomContentInitialized,timestamp:Date.now()}),!0;if(window.sokucomContentInitialized,"performAction"===e.action){if("undefined"==typeof document||null===document)return n({status:"error",message:"Document is not available"}),!0;try{document.querySelectorAll("a").forEach((e=>{}))}catch(e){return n({status:"error",message:e.toString()}),!0}n({status:"content script processed request"})}if("callPhoneAction"===e.action){if("undefined"==typeof document||null===document)return n({status:"error",message:"Document is not available for phone action"}),!0;try{const t=document.querySelector('div [data-testid="home"]');if(!t)return n({status:"error",message:"Home element not found - ページ構造が変わっている可能性があります"}),!0;const o=t.nextElementSibling;if(!o)return n({status:"error",message:"電話番号入力エリアが見つかりません"}),!0;o.classList.contains("translate-y-[620px]")&&o.classList.remove("translate-y-[620px]");const s=e.phoneNumber||"09012345678",r={},a=o.querySelectorAll("button");let i=0;if(a.forEach((e=>{e.textContent&&-1!==e.textContent.search(/^[0-9]$/)&&(r[e.textContent]=e,i++)})),0===i)return n({status:"error",message:"数字ボタンが見つかりません"}),!0;let u=null;const l=o.querySelectorAll("button > i.fa-phone");l&&l.length>0&&(u=l[0].parentElement);let c=0;return s.split("").forEach(((t,o)=>{setTimeout((()=>{r[t]?(r[t].click(),c++,o===s.length-1&&(c===s.length?e.autoCall&&u?setTimeout((()=>{u.click(),n({status:"phone call initiated",message:"電話番号がダイヤルされ、発信が開始されました",phoneNumber:s})}),500):e.autoCall&&!u?n({status:"phone number dialed",message:"電話番号が正常にダイヤルされましたが、発信ボタンが見つからないため発信は行われませんでした",phoneNumber:s}):n({status:"phone number dialed",message:"電話番号が正常にダイヤルされました",phoneNumber:s}):n({status:"phone number partially dialed",message:`電話番号の一部(${c}/${s.length})のみダイヤルされました`,phoneNumber:s}))):o===s.length-1&&n({status:"phone number partially dialed",message:`電話番号の一部(${c}/${s.length})のみダイヤルされました`,phoneNumber:s})}),100*o)})),!0}catch(e){n({status:"error",message:"電話アクション実行中にエラーが発生しました: "+(e.message||String(e))})}return!0}return!0}catch(e){return n({status:"error",message:"コンテンツスクリプトで予期しないエラーが発生しました: "+(e.message||String(e))}),!0}})),document.addEventListener("visibilitychange",(()=>{"visible"!==document.visibilityState||window.sokucomContentInitialized||e()})),window.addEventListener("load",(()=>{window.sokucomContentInitialized||e()}))})();